<!--<!DOCTYPE html>-->
<!--<html lang="vi">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>DÃ² sá»‘ - Xá»• sá»‘ thÃ´ng minh</title>-->
<!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">-->
<!--</head>-->
<!--<body class="bg-light">-->
<!--<div class="container py-4">-->
<!--    <h2 class="text-center mb-4">ğŸ¯ DÃ² Sá»‘ Xá»• Sá»‘ 3 Miá»n</h2>-->

<!--    <form id="form-do-so" class="row g-3">-->
<!--        <div class="col-md-4">-->
<!--            <label class="form-label">Sá»‘ Ä‘Ã¡nh</label>-->
<!--            <input type="text" class="form-control" name="soDanh" required>-->
<!--        </div>-->

<!--        <div class="col-md-4">-->
<!--            <label class="form-label">CÃ¡ch Ä‘Ã¡nh</label>-->
<!--            <select class="form-select" name="cachDanh" required>-->
<!--                <option value="2 chÃ¢n">2 CHÃ‚N</option>-->
<!--                <option value="3 chÃ¢n">3 CHÃ‚N</option>-->
<!--                <option value="Ä‘áº§u">Äáº¦U</option>-->
<!--                <option value="Ä‘uÃ´i">ÄUÃ”I</option>-->
<!--                <option value="lá»›n">Lá»šN</option>-->
<!--                <option value="nhá»">NHá»</option>-->
<!--                <option value="Ä‘áº§u Ä‘uÃ´i">Äáº¦U ÄUÃ”I</option>-->
<!--            </select>-->
<!--        </div>-->

<!--        <div class="col-md-4">-->
<!--            <label class="form-label">Miá»n</label>-->
<!--            <select class="form-select" name="mien" required>-->
<!--                <option value="">&#45;&#45;Chá»n&#45;&#45;</option>-->
<!--                <option>MIá»€N Báº®C</option>-->
<!--                <option>MIá»€N TRUNG</option>-->
<!--                <option>MIá»€N NAM</option>-->
<!--            </select>-->
<!--        </div>-->

<!--        <div class="col-md-4">-->
<!--            <label class="form-label">TÃªn Ä‘Ã i (tuá»³ chá»n)</label>-->
<!--            <input type="text" class="form-control" name="tenDai" placeholder="VD: HCM, LONG AN, 3 ÄÃ€I">-->
<!--        </div>-->

<!--        <div class="col-md-4">-->
<!--            <label class="form-label">NgÃ y</label>-->
<!--            <input type="date" class="form-control" name="ngay" required>-->
<!--        </div>-->

<!--        &lt;!&ndash; Tiá»n Ä‘Ã¡nh (hiá»‡n náº¿u khÃ´ng pháº£i 3 CHÃ‚N) &ndash;&gt;-->
<!--        <div class="col-md-4" id="tien-danh-field">-->
<!--            <label class="form-label">Tiá»n Ä‘Ã¡nh</label>-->
<!--            <input type="number" class="form-control" name="tienDanh" required min="1">-->
<!--        </div>-->

<!--        &lt;!&ndash; Tiá»n riÃªng cho 3 CHÃ‚N &ndash;&gt;-->
<!--        <div id="nhieu-tien-3chan" class="row d-none">-->
<!--            <div class="col-md-4">-->
<!--                <label class="form-label">Tiá»n bao lÃ´</label>-->
<!--                <input type="number" class="form-control" name="tienBaoLo" min="0">-->
<!--            </div>-->
<!--            <div class="col-md-4">-->
<!--                <label class="form-label">Tiá»n ThÆ°á»Ÿng</label>-->
<!--                <input type="number" class="form-control" name="tienThuong" min="0">-->
<!--            </div>-->
<!--            <div class="col-md-4">-->
<!--                <label class="form-label">Tiá»n Ä‘áº·c biá»‡t</label>-->
<!--                <input type="number" class="form-control" name="tienDacBiet" min="0">-->
<!--            </div>-->
<!--        </div>-->

<!--        <div class="col-12 text-center">-->
<!--            <button type="submit" class="btn btn-primary px-4">ğŸ” DÃ² sá»‘</button>-->
<!--        </div>-->
<!--    </form>-->

<!--    <hr>-->

<!--    <div id="ket-qua" class="mt-4"></div>-->
<!--</div>-->

<!--<script>-->
<!--    const form = document.getElementById('form-do-so');-->
<!--    const cachDanhSelect = form.querySelector('[name="cachDanh"]');-->
<!--    const tienDanhField = document.getElementById('tien-danh-field');-->
<!--    const nhieuTienDiv = document.getElementById('nhieu-tien-3chan');-->

<!--    function updateTienFields() {-->
<!--        const value = cachDanhSelect.value.toLowerCase();-->
<!--        if (value === '3 chÃ¢n') {-->
<!--            tienDanhField.classList.add('d-none');-->
<!--            nhieuTienDiv.classList.remove('d-none');-->
<!--        } else {-->
<!--            tienDanhField.classList.remove('d-none');-->
<!--            nhieuTienDiv.classList.add('d-none');-->
<!--        }-->
<!--    }-->

<!--    cachDanhSelect.addEventListener('change', updateTienFields);-->

<!--    // âœ… Váº¤N Äá»€ 1: Ä‘áº£m báº£o update sau khi load hoÃ n toÃ n-->
<!--    window.addEventListener('load', () => {-->
<!--        updateTienFields();-->
<!--    });-->

<!--    form.addEventListener('submit', async function (e) {-->
<!--        e.preventDefault();-->

<!--        const data = {};-->
<!--        const formData = new FormData(form);-->

<!--        data.soDanh = formData.get("soDanh");-->
<!--        data.cachDanh = formData.get("cachDanh").toLowerCase();-->
<!--        data.mien = formData.get("mien");-->
<!--        data.tenDai = formData.get("tenDai");-->
<!--        data.ngay = formData.get("ngay");-->

<!--        if (data.cachDanh === '3 chÃ¢n') {-->
<!--            const baoLo = form.querySelector('[name="tienBaoLo"]').value || "0";-->
<!--            const thuong = form.querySelector('[name="tienThuong"]').value || "0";-->
<!--            const dacBiet = form.querySelector('[name="tienDacBiet"]').value || "0";-->
<!--            data.tienDanh = `${baoLo}-${thuong}-${dacBiet}`;-->
<!--        } else {-->
<!--            data.tienDanh = form.querySelector('[name="tienDanh"]').value || "0";-->
<!--        }-->



<!--        try {-->
<!--            const response = await fetch('/xoso/doiso', {-->
<!--                method: 'POST',-->
<!--                headers: { 'Content-Type': 'application/json' },-->
<!--                body: JSON.stringify(data)-->
<!--            });-->

<!--            if (!response.ok) {-->
<!--                const errorText = await response.text();-->
<!--                throw new Error(`Lá»—i server: ${response.status}\n${errorText}`);-->
<!--            }-->

<!--            const ketQua = await response.json();-->

<!--            document.getElementById('ket-qua').innerHTML = `-->
<!--        <div class="alert alert-${ketQua.trung ? 'success' : 'danger'}">-->
<!--            <strong>Káº¿t quáº£:</strong> ${ketQua.trung ? 'ğŸ‰ TRÃšNG Sá»!' : 'ğŸ’” KHÃ”NG TRÃšNG'}<br>-->
<!--            ${ketQua.tienTrungBaoLo !== undefined ? `ğŸ’° Bao lÃ´: ${ketQua.tienTrungBaoLo}<br>` : ''}-->
<!--            ${ketQua.tienTrungThuong !== undefined ? `ğŸ† ThÆ°á»£ng : ${ketQua.tienTrungThuong}<br>` : ''}-->
<!--            ${ketQua.tienTrungDacBiet !== undefined ? `ğŸ¯ Äáº·c biá»‡t: ${ketQua.tienTrungDacBiet}<br>` : ''}-->
<!--        </div>-->
<!--        <pre>${JSON.stringify(ketQua, null, 2)}</pre>-->
<!--    `;-->
<!--        } catch (err) {-->
<!--            document.getElementById('ket-qua').innerHTML = `-->
<!--        <div class="alert alert-danger">-->
<!--            <strong>Lá»—i:</strong><br>-->
<!--            ${err.message.replaceAll('<', '&lt;')}-->
<!--        </div>-->
<!--    `;-->
<!--        }-->

<!--    });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->







<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>DÃ² sá»‘ - Xá»• sá»‘ thÃ´ng minh</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        .form-mini .form-label,
        .form-mini .form-control,
        .form-mini .form-select {
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
        }
    </style>
</head>
<body class="bg-light">
<div class="container py-3">
    <h3 class="text-center mb-3">ğŸ¯ DÃ² Sá»‘ Xá»• Sá»‘ 3 Miá»n</h3>

    <form id="form-do-so" class="row g-2 form-mini">
        <div class="col-md-2">
            <label class="form-label">Sá»‘ Ä‘Ã¡nh</label>
            <input type="text" class="form-control" name="soDanh" required>
        </div>
        <div class="col-md-2">
            <label class="form-label">CÃ¡ch Ä‘Ã¡nh</label>
            <select class="form-select" name="cachDanh" required>
                <option value="2 chÃ¢n">2 CHÃ‚N</option>
                <option value="3 chÃ¢n">3 CHÃ‚N</option>
                <option value="Ä‘áº§u">Äáº¦U</option>
                <option value="Ä‘uÃ´i">ÄUÃ”I</option>
                <option value="lá»›n">Lá»šN</option>
                <option value="nhá»">NHá»</option>
                <option value="Ä‘áº§u Ä‘uÃ´i">Äáº¦U ÄUÃ”I</option>
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Miá»n</label>
            <select class="form-select" name="mien" required>
                <option value="">--Chá»n--</option>
                <option>MIá»€N Báº®C</option>
                <option>MIá»€N TRUNG</option>
                <option>MIá»€N NAM</option>
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">TÃªn Ä‘Ã i (tuá»³ chá»n)</label>
            <input type="text" class="form-control" name="tenDai" placeholder="VD: HCM, LA, 3 ÄÃ€I">
        </div>
        <div class="col-md-2">
            <label class="form-label">NgÃ y</label>
            <input type="date" class="form-control" name="ngay" required>
        </div>

        <div class="col-md-2" id="tien-danh-field">
            <label class="form-label">Tiá»n Ä‘Ã¡nh</label>
            <input type="number" class="form-control" name="tienDanh" min="1">
        </div>

        <div id="nhieu-tien-3chan" class="row d-none">
            <div class="col-md-2">
                <label class="form-label">Tiá»n bao lÃ´</label>
                <input type="number" class="form-control" name="tienBaoLo" min="0">
            </div>
            <div class="col-md-2">
                <label class="form-label">Tiá»n ThÆ°á»Ÿng</label>
                <input type="number" class="form-control" name="tienThuong" min="0">
            </div>
            <div class="col-md-2">
                <label class="form-label">Tiá»n Äáº·c biá»‡t</label>
                <input type="number" class="form-control" name="tienDacBiet" min="0">
            </div>
        </div>

        <div class="col-12 text-center">
            <button type="submit" class="btn btn-primary px-4">ğŸ” DÃ² sá»‘</button>
        </div>
    </form>

    <hr>

    <div id="ket-qua" class="mt-3"></div>

    <h4 class="mt-4 text-center">ğŸ“‹ Káº¿t Quáº£ Xá»• Sá»‘ Theo NgÃ y</h4>
    <div class="row justify-content-center mb-2">
        <div class="col-md-3">
            <input type="date" id="ngay-ketqua" class="form-control" placeholder="Chá»n ngÃ y">
        </div>
        <div class="col-md-2">
            <button class="btn btn-secondary w-100" onclick="taiKetQuaXoSoTheoNgay()">ğŸ“‹ Xem Káº¿t Quáº£</button>
        </div>
    </div>
    <div id="bang-ket-qua-3mien" class="table-responsive mt-2"></div>


</div>

<script>
    const form = document.getElementById('form-do-so');
    const cachDanhSelect = form.querySelector('[name="cachDanh"]');
    const tienDanhField = document.getElementById('tien-danh-field');
    const nhieuTienDiv = document.getElementById('nhieu-tien-3chan');

    function updateTienFields() {
        const value = cachDanhSelect.value.toLowerCase();
        if (value === '3 chÃ¢n') {
            tienDanhField.classList.add('d-none');
            nhieuTienDiv.classList.remove('d-none');
        } else {
            tienDanhField.classList.remove('d-none');
            nhieuTienDiv.classList.add('d-none');
        }
    }

    cachDanhSelect.addEventListener('change', updateTienFields);
    window.addEventListener('load', () => {
        updateTienFields();
        taiKetQuaXoSo3Mien();
    });

    form.addEventListener('submit', async function (e) {
        e.preventDefault();

        const data = {};
        const formData = new FormData(form);

        data.soDanh = formData.get("soDanh");
        data.cachDanh = formData.get("cachDanh").toLowerCase();
        data.mien = formData.get("mien");
        data.tenDai = formData.get("tenDai");
        data.ngay = formData.get("ngay");

        if (data.cachDanh === '3 chÃ¢n') {
            if (data.cachDanh === '3 chÃ¢n') {
                const baoLo = form.querySelector('[name="tienBaoLo"]').value || "0";
                const thuong = form.querySelector('[name="tienThuong"]').value || "0";
                const dacBiet = form.querySelector('[name="tienDacBiet"]').value || "0";
                data.tienDanh = `${baoLo}-${thuong}-${dacBiet}`;
            }

        } else {
            data.tienDanh = form.querySelector('[name="tienDanh"]').value || "0";
        }

        try {
            const response = await fetch('/xoso/doiso', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const ketQua = await response.json();
            document.getElementById('ket-qua').innerHTML = `
                <div class="alert alert-${ketQua.trung ? 'success' : 'danger'}">
                    <strong>Káº¿t quáº£:</strong> ${ketQua.trung ? 'ğŸ‰ TRÃšNG Sá»!' : 'ğŸ’” KHÃ”NG TRÃšNG'}<br>
                    ${ketQua.tienTrungBaoLo !== undefined ? `ğŸ’° Bao lÃ´: ${ketQua.tienTrungBaoLo}<br>` : ''}
                    ${ketQua.tienTrungThuong !== undefined ? `ğŸ† ThÆ°á»Ÿng: ${ketQua.tienTrungThuong}<br>` : ''}
                    ${ketQua.tienTrungDacBiet !== undefined ? `ğŸ¯ Äáº·c biá»‡t: ${ketQua.tienTrungDacBiet}<br>` : ''}
                </div>
                <pre>${JSON.stringify(ketQua, null, 2)}</pre>
            `;
        } catch (err) {
            document.getElementById('ket-qua').innerHTML = `
                <div class="alert alert-danger">
                    <strong>Lá»—i:</strong><br>
                    ${err.message.replaceAll('<', '&lt;')}
                </div>
            `;
        }
    });

    async function taiKetQuaXoSoTheoNgay() {
        const ngay = document.getElementById('ngay-ketqua').value;
        if (!ngay) {
            alert("Vui lÃ²ng chá»n ngÃ y cáº§n xem káº¿t quáº£!");
            return;
        }

        try {
            const response = await fetch(`/xoso/ketqua?ngay=${ngay}`);
            const data = await response.json();

            let html = '';
            ['MIá»€N Báº®C', 'MIá»€N TRUNG', 'MIá»€N NAM'].forEach(mien => {
                html += `<h5 class="mt-3">${mien}</h5>`;
                const dsDai = data.filter(d => d.mien === mien);
                if (dsDai.length === 0) {
                    html += `<div class="text-muted">KhÃ´ng cÃ³ káº¿t quáº£</div>`;
                } else {
                    dsDai.forEach(dai => {
                        html += `<strong>${dai.tenDai}</strong>`;
                        html += `<table class="table table-bordered table-sm mt-1">
                        <thead><tr><th>Giáº£i</th><th>Sá»‘ trÃºng</th></tr></thead>
                        <tbody>
                            ${dai.ketQua.map(kq => `<tr><td>${kq.giai}</td><td>${kq.soTrung}</td></tr>`).join('')}
                        </tbody>
                    </table>`;
                    });
                }
            });

            document.getElementById('bang-ket-qua-3mien').innerHTML = html;

        } catch (e) {
            document.getElementById('bang-ket-qua-3mien').innerHTML =
                '<div class="text-danger">KhÃ´ng táº£i Ä‘Æ°á»£c káº¿t quáº£. Kiá»ƒm tra káº¿t ná»‘i hoáº·c dá»¯ liá»‡u.</div>';
        }
    }


</script>
</body>
</html>
