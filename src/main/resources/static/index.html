<!--<!DOCTYPE html>-->
<!--<html lang="vi">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Dò số - Xổ số thông minh</title>-->
<!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">-->
<!--</head>-->
<!--<body class="bg-light">-->
<!--<div class="container py-4">-->
<!--    <h2 class="text-center mb-4">🎯 Dò Số Xổ Số 3 Miền</h2>-->

<!--    <form id="form-do-so" class="row g-3">-->
<!--        <div class="col-md-4">-->
<!--            <label class="form-label">Số đánh</label>-->
<!--            <input type="text" class="form-control" name="soDanh" required>-->
<!--        </div>-->

<!--        <div class="col-md-4">-->
<!--            <label class="form-label">Cách đánh</label>-->
<!--            <select class="form-select" name="cachDanh" required>-->
<!--                <option value="2 chân">2 CHÂN</option>-->
<!--                <option value="3 chân">3 CHÂN</option>-->
<!--                <option value="đầu">ĐẦU</option>-->
<!--                <option value="đuôi">ĐUÔI</option>-->
<!--                <option value="lớn">LỚN</option>-->
<!--                <option value="nhỏ">NHỎ</option>-->
<!--                <option value="đầu đuôi">ĐẦU ĐUÔI</option>-->
<!--            </select>-->
<!--        </div>-->

<!--        <div class="col-md-4">-->
<!--            <label class="form-label">Miền</label>-->
<!--            <select class="form-select" name="mien" required>-->
<!--                <option value="">&#45;&#45;Chọn&#45;&#45;</option>-->
<!--                <option>MIỀN BẮC</option>-->
<!--                <option>MIỀN TRUNG</option>-->
<!--                <option>MIỀN NAM</option>-->
<!--            </select>-->
<!--        </div>-->

<!--        <div class="col-md-4">-->
<!--            <label class="form-label">Tên đài (tuỳ chọn)</label>-->
<!--            <input type="text" class="form-control" name="tenDai" placeholder="VD: HCM, LONG AN, 3 ĐÀI">-->
<!--        </div>-->

<!--        <div class="col-md-4">-->
<!--            <label class="form-label">Ngày</label>-->
<!--            <input type="date" class="form-control" name="ngay" required>-->
<!--        </div>-->

<!--        &lt;!&ndash; Tiền đánh (hiện nếu không phải 3 CHÂN) &ndash;&gt;-->
<!--        <div class="col-md-4" id="tien-danh-field">-->
<!--            <label class="form-label">Tiền đánh</label>-->
<!--            <input type="number" class="form-control" name="tienDanh" required min="1">-->
<!--        </div>-->

<!--        &lt;!&ndash; Tiền riêng cho 3 CHÂN &ndash;&gt;-->
<!--        <div id="nhieu-tien-3chan" class="row d-none">-->
<!--            <div class="col-md-4">-->
<!--                <label class="form-label">Tiền bao lô</label>-->
<!--                <input type="number" class="form-control" name="tienBaoLo" min="0">-->
<!--            </div>-->
<!--            <div class="col-md-4">-->
<!--                <label class="form-label">Tiền Thưởng</label>-->
<!--                <input type="number" class="form-control" name="tienThuong" min="0">-->
<!--            </div>-->
<!--            <div class="col-md-4">-->
<!--                <label class="form-label">Tiền đặc biệt</label>-->
<!--                <input type="number" class="form-control" name="tienDacBiet" min="0">-->
<!--            </div>-->
<!--        </div>-->

<!--        <div class="col-12 text-center">-->
<!--            <button type="submit" class="btn btn-primary px-4">🔍 Dò số</button>-->
<!--        </div>-->
<!--    </form>-->

<!--    <hr>-->

<!--    <div id="ket-qua" class="mt-4"></div>-->
<!--</div>-->

<!--<script>-->
<!--    const form = document.getElementById('form-do-so');-->
<!--    const cachDanhSelect = form.querySelector('[name="cachDanh"]');-->
<!--    const tienDanhField = document.getElementById('tien-danh-field');-->
<!--    const nhieuTienDiv = document.getElementById('nhieu-tien-3chan');-->

<!--    function updateTienFields() {-->
<!--        const value = cachDanhSelect.value.toLowerCase();-->
<!--        if (value === '3 chân') {-->
<!--            tienDanhField.classList.add('d-none');-->
<!--            nhieuTienDiv.classList.remove('d-none');-->
<!--        } else {-->
<!--            tienDanhField.classList.remove('d-none');-->
<!--            nhieuTienDiv.classList.add('d-none');-->
<!--        }-->
<!--    }-->

<!--    cachDanhSelect.addEventListener('change', updateTienFields);-->

<!--    // ✅ VẤN ĐỀ 1: đảm bảo update sau khi load hoàn toàn-->
<!--    window.addEventListener('load', () => {-->
<!--        updateTienFields();-->
<!--    });-->

<!--    form.addEventListener('submit', async function (e) {-->
<!--        e.preventDefault();-->

<!--        const data = {};-->
<!--        const formData = new FormData(form);-->

<!--        data.soDanh = formData.get("soDanh");-->
<!--        data.cachDanh = formData.get("cachDanh").toLowerCase();-->
<!--        data.mien = formData.get("mien");-->
<!--        data.tenDai = formData.get("tenDai");-->
<!--        data.ngay = formData.get("ngay");-->

<!--        if (data.cachDanh === '3 chân') {-->
<!--            const baoLo = form.querySelector('[name="tienBaoLo"]').value || "0";-->
<!--            const thuong = form.querySelector('[name="tienThuong"]').value || "0";-->
<!--            const dacBiet = form.querySelector('[name="tienDacBiet"]').value || "0";-->
<!--            data.tienDanh = `${baoLo}-${thuong}-${dacBiet}`;-->
<!--        } else {-->
<!--            data.tienDanh = form.querySelector('[name="tienDanh"]').value || "0";-->
<!--        }-->



<!--        try {-->
<!--            const response = await fetch('/xoso/doiso', {-->
<!--                method: 'POST',-->
<!--                headers: { 'Content-Type': 'application/json' },-->
<!--                body: JSON.stringify(data)-->
<!--            });-->

<!--            if (!response.ok) {-->
<!--                const errorText = await response.text();-->
<!--                throw new Error(`Lỗi server: ${response.status}\n${errorText}`);-->
<!--            }-->

<!--            const ketQua = await response.json();-->

<!--            document.getElementById('ket-qua').innerHTML = `-->
<!--        <div class="alert alert-${ketQua.trung ? 'success' : 'danger'}">-->
<!--            <strong>Kết quả:</strong> ${ketQua.trung ? '🎉 TRÚNG SỐ!' : '💔 KHÔNG TRÚNG'}<br>-->
<!--            ${ketQua.tienTrungBaoLo !== undefined ? `💰 Bao lô: ${ketQua.tienTrungBaoLo}<br>` : ''}-->
<!--            ${ketQua.tienTrungThuong !== undefined ? `🏆 Thượng : ${ketQua.tienTrungThuong}<br>` : ''}-->
<!--            ${ketQua.tienTrungDacBiet !== undefined ? `🎯 Đặc biệt: ${ketQua.tienTrungDacBiet}<br>` : ''}-->
<!--        </div>-->
<!--        <pre>${JSON.stringify(ketQua, null, 2)}</pre>-->
<!--    `;-->
<!--        } catch (err) {-->
<!--            document.getElementById('ket-qua').innerHTML = `-->
<!--        <div class="alert alert-danger">-->
<!--            <strong>Lỗi:</strong><br>-->
<!--            ${err.message.replaceAll('<', '&lt;')}-->
<!--        </div>-->
<!--    `;-->
<!--        }-->

<!--    });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->







<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dò số - Xổ số thông minh</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
        .form-mini .form-label,
        .form-mini .form-control,
        .form-mini .form-select {
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
        }
    </style>
</head>
<body class="bg-light">
<div class="container py-3">
    <h3 class="text-center mb-3">🎯 Dò Số Xổ Số 3 Miền</h3>

    <form id="form-do-so" class="row g-2 form-mini">
        <div class="col-md-2">
            <label class="form-label">Số đánh</label>
            <input type="text" class="form-control" name="soDanh" required>
        </div>
        <div class="col-md-2">
            <label class="form-label">Cách đánh</label>
            <select class="form-select" name="cachDanh" required>
                <option value="2 chân">2 CHÂN</option>
                <option value="3 chân">3 CHÂN</option>
                <option value="đầu">ĐẦU</option>
                <option value="đuôi">ĐUÔI</option>
                <option value="lớn">LỚN</option>
                <option value="nhỏ">NHỎ</option>
                <option value="đầu đuôi">ĐẦU ĐUÔI</option>
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Miền</label>
            <select class="form-select" name="mien" required>
                <option value="">--Chọn--</option>
                <option>MIỀN BẮC</option>
                <option>MIỀN TRUNG</option>
                <option>MIỀN NAM</option>
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Tên đài (tuỳ chọn)</label>
            <input type="text" class="form-control" name="tenDai" placeholder="VD: HCM, LA, 3 ĐÀI">
        </div>
        <div class="col-md-2">
            <label class="form-label">Ngày</label>
            <input type="date" class="form-control" name="ngay" required>
        </div>

        <div class="col-md-2" id="tien-danh-field">
            <label class="form-label">Tiền đánh</label>
            <input type="number" class="form-control" name="tienDanh" min="1">
        </div>

        <div id="nhieu-tien-3chan" class="row d-none">
            <div class="col-md-2">
                <label class="form-label">Tiền bao lô</label>
                <input type="number" class="form-control" name="tienBaoLo" min="0">
            </div>
            <div class="col-md-2">
                <label class="form-label">Tiền Thưởng</label>
                <input type="number" class="form-control" name="tienThuong" min="0">
            </div>
            <div class="col-md-2">
                <label class="form-label">Tiền Đặc biệt</label>
                <input type="number" class="form-control" name="tienDacBiet" min="0">
            </div>
        </div>

        <div class="col-12 text-center">
            <button type="submit" class="btn btn-primary px-4">🔍 Dò số</button>
        </div>
    </form>

    <hr>

    <div id="ket-qua" class="mt-3"></div>

    <h4 class="mt-4 text-center">📋 Kết Quả Xổ Số Theo Ngày</h4>
    <div class="row justify-content-center mb-2">
        <div class="col-md-3">
            <input type="date" id="ngay-ketqua" class="form-control" placeholder="Chọn ngày">
        </div>
        <div class="col-md-2">
            <button class="btn btn-secondary w-100" onclick="taiKetQuaXoSoTheoNgay()">📋 Xem Kết Quả</button>
        </div>
    </div>
    <div id="bang-ket-qua-3mien" class="table-responsive mt-2"></div>


</div>

<script>
    const form = document.getElementById('form-do-so');
    const cachDanhSelect = form.querySelector('[name="cachDanh"]');
    const tienDanhField = document.getElementById('tien-danh-field');
    const nhieuTienDiv = document.getElementById('nhieu-tien-3chan');

    function updateTienFields() {
        const value = cachDanhSelect.value.toLowerCase();
        if (value === '3 chân') {
            tienDanhField.classList.add('d-none');
            nhieuTienDiv.classList.remove('d-none');
        } else {
            tienDanhField.classList.remove('d-none');
            nhieuTienDiv.classList.add('d-none');
        }
    }

    cachDanhSelect.addEventListener('change', updateTienFields);
    window.addEventListener('load', () => {
        updateTienFields();
        taiKetQuaXoSo3Mien();
    });

    form.addEventListener('submit', async function (e) {
        e.preventDefault();

        const data = {};
        const formData = new FormData(form);

        data.soDanh = formData.get("soDanh");
        data.cachDanh = formData.get("cachDanh").toLowerCase();
        data.mien = formData.get("mien");
        data.tenDai = formData.get("tenDai");
        data.ngay = formData.get("ngay");

        if (data.cachDanh === '3 chân') {
            if (data.cachDanh === '3 chân') {
                const baoLo = form.querySelector('[name="tienBaoLo"]').value || "0";
                const thuong = form.querySelector('[name="tienThuong"]').value || "0";
                const dacBiet = form.querySelector('[name="tienDacBiet"]').value || "0";
                data.tienDanh = `${baoLo}-${thuong}-${dacBiet}`;
            }

        } else {
            data.tienDanh = form.querySelector('[name="tienDanh"]').value || "0";
        }

        try {
            const response = await fetch('/xoso/doiso', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const ketQua = await response.json();
            document.getElementById('ket-qua').innerHTML = `
                <div class="alert alert-${ketQua.trung ? 'success' : 'danger'}">
                    <strong>Kết quả:</strong> ${ketQua.trung ? '🎉 TRÚNG SỐ!' : '💔 KHÔNG TRÚNG'}<br>
                    ${ketQua.tienTrungBaoLo !== undefined ? `💰 Bao lô: ${ketQua.tienTrungBaoLo}<br>` : ''}
                    ${ketQua.tienTrungThuong !== undefined ? `🏆 Thưởng: ${ketQua.tienTrungThuong}<br>` : ''}
                    ${ketQua.tienTrungDacBiet !== undefined ? `🎯 Đặc biệt: ${ketQua.tienTrungDacBiet}<br>` : ''}
                </div>
                <pre>${JSON.stringify(ketQua, null, 2)}</pre>
            `;
        } catch (err) {
            document.getElementById('ket-qua').innerHTML = `
                <div class="alert alert-danger">
                    <strong>Lỗi:</strong><br>
                    ${err.message.replaceAll('<', '&lt;')}
                </div>
            `;
        }
    });

    async function taiKetQuaXoSoTheoNgay() {
        const ngay = document.getElementById('ngay-ketqua').value;
        if (!ngay) {
            alert("Vui lòng chọn ngày cần xem kết quả!");
            return;
        }

        try {
            const response = await fetch(`/xoso/ketqua?ngay=${ngay}`);
            const data = await response.json();

            let html = '';
            ['MIỀN BẮC', 'MIỀN TRUNG', 'MIỀN NAM'].forEach(mien => {
                html += `<h5 class="mt-3">${mien}</h5>`;
                const dsDai = data.filter(d => d.mien === mien);
                if (dsDai.length === 0) {
                    html += `<div class="text-muted">Không có kết quả</div>`;
                } else {
                    dsDai.forEach(dai => {
                        html += `<strong>${dai.tenDai}</strong>`;
                        html += `<table class="table table-bordered table-sm mt-1">
                        <thead><tr><th>Giải</th><th>Số trúng</th></tr></thead>
                        <tbody>
                            ${dai.ketQua.map(kq => `<tr><td>${kq.giai}</td><td>${kq.soTrung}</td></tr>`).join('')}
                        </tbody>
                    </table>`;
                    });
                }
            });

            document.getElementById('bang-ket-qua-3mien').innerHTML = html;

        } catch (e) {
            document.getElementById('bang-ket-qua-3mien').innerHTML =
                '<div class="text-danger">Không tải được kết quả. Kiểm tra kết nối hoặc dữ liệu.</div>';
        }
    }


</script>
</body>
</html>
